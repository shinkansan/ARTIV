# CAN 통신이란 무엇인가?
여호영 / 2020.02.23

## 통신이란?
CAN 통신을 이해하기 전에 통신이라는 것을 먼저 이해해보자.
통신을 할 때는 크게 송수신기, 전송 매체, Protocol로 이루어져 있다.

1. 송수신기   

    송수신기에는 ECU, Actuator, Sensor 등이 있다.   
    Actuator와 Sensor는 정보를 주기만 하는 송신기이고, ECU는 정보를 주기도, 받기도 하는 송수신기이다!

2. 전송 매체   

    전송 매체에는 말 그대로 '어떤 것'이 데이터를 옮겨주느냐이다.   
    고등학교 물리 책에도 있듯이 일반적으론 전선을 쓰고 데이터를 빨리 보낼 수 있는 광케이블을 이용하기도 한다.

3. Protocol

    마지막으로 Protocol 부분이다. 이는 컴퓨터 쪽에 관심이 있다면 한 번 쯤은 들어봤을 단어이다.   
Protocol은 소프트웨어인 점에서 송수신기와 전송 매체와 다르다. Protocol의 의미는 데이터를 주고받을 때 일종의 약속이라고 생각하면 된다.
송수신기 사이에 데이터를 주고 받을 때 문자 그대로 데이터가 이동하는 것이 아니라 알아들을 수 없는 형태의 데이터가 이동한다.
이때 Protocol이 같은 송수신기에서 데이터를 보내거나 받을 때 동일한 규칙을 가지고 데이터를 변환한다.
예를 들면, 나랑 내 친구가 외국에 나가서 한국어로 얘기할 때 나랑 내 친구는 한국어라는 같은 Protocol을 가지고 있다고 생각하면 된다.
Protocol에는 여러가지 방식이 있는데 그 중에서 가장 많이 사용하는 방식은 Ethernet이다.
우리가 평소에 랜선이라고 하는 케이블을 가지고 인터넷을 받아오는데 그 방식이라고 생각하면 된다.

## 데이터 송신
우리가 흔히 랜선이라고 하는 LAN 포트로 데이터를 전송할 컴퓨터의 IP 주소를 확인한 후에 MAC 주소로 변경해서 데이터를 전송하게 된다.
여기서 MAC 주소는 랜카드가 LAN 카드가 이해할 수 있는 물리적인 주소를 말한다.

## 데이터 수신
네트워크 회선 상의 데이터를 받게 되면 먼저 MAC 주소를 확인하고 자신의 IP 주소와 동일한 경우 해당 데이터를 열어서 분석하게 된다.

## 통신의 종류
통신을 할 때 데이터를 전송할 때 어떻게 보내는 지에 따라서 두 가지, 동기 통신과 비동기 통신으로 나눌 수 있다.

1. 동기 통신
    - 정해진 수만큼의 문자열을 한 묶음으로 하여 한 번에 전송하는 방식이다.
    - 손신과 수신측의 시간적 지연을 방지하기 위해 하나의 기준인 클락(SCK선)으로 동기신호를 맞추어 3선식으로 동작한다.
    - SCK 선에 문제가 발생되면 데이터가 출력되어도 시스템이 작동하지 않는다.
    
2. 비동기 통신
    - 데이터를 보낼 때 한 번에 한 문자씩 전송되는 방식이다.
    - Start bit, stop bit가 그 예시이다.
    - CAN 통신과 같은 불규칙적인 전송에 적합하다.
    - 단선이라 단락으로 인해 시스템이 작동하지 않는 것을 대비해 2선으로 되어있으며 선 하나에 이상이 발생되면 다른 선에 의해 작동된다.
    
## CSMD/CD 동작 (Carrier Sense Multiple Access/Collision Detect)
CSMD/CD는 다음과 같은 순서를 통해서 작동한다.

1. BUS 선 상에 이미 다른 신호가 있는지 감지한다.
2. BUS 선이 사용 중이면 잠시 기다린다.
3. BUS 선이 사용 가능(idle)하면 데이터를 전송한다.
4. 만약 수신 컴퓨터가 응답이 없거나 다른 신호와 충돌이 발생하면 일정시간 동안 대기 후 다시 시도한다.

## 정리
CAN 통신을 이해하기 전에 기본적인 통신에 대해서 먼저 이해할 수 있도록 하자.    
위의 설명과 같이 통신에는 하드웨어/소프트웨어 적인 요소가 있으며 종류에도 여러 가지가 있고, 동작 방식에도 여러 가지가 있다.    
특히 CAN은 동기/비동기 통신 중에서 비동기 통신 방식이며 CSMD/CD 방식으로 동작한다.    
다음 Part에서는 CAN 통신에 대해서 본격적으로 알아보자.
