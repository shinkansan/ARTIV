# HD Map과 다른 OpenPlatform의 HD Map 비교해보기
Author : 신관준 / 2020.02.25.

## Introduction
지금 시중에 풀려있는 차들은 반자율주행이라는 표현을 쓰는데, 대부분 레이더와 카메라를 이용하여 ADAS, LDA, LKAS 같은 반자율주행 기능들을 자동차에 탑재한다.   
좋은 기능들이지만, 여전히 자동차는 앞의 상황만을 센서로 의존하면서 동작하고 다양한 도로상황에 대처하지 못하는 문제점들이 많다. 그래서 결국
자율주행 LV 3 이상으로 갈려면 HD Map 혹은 그에 대응하는 위치측위 시스템이 필요하다. 자동차가 스스로 앞에 뭐가 있는지 혹은 어떤 Traffic Infra가 있는지 알고
대응하는 움직임은 지금의 반자율주행과는 훨 다를 것이다.

## Open Platform
2020년 현재 다양한 자율주행 오픈플랫폼이 있다. Baidu의 [__Apollo__](https://github.com/ApolloAuto/apollo), TierIV의 [__Autoware__](https://gitlab.com/autowarefoundation/autoware.ai), Comma AI의 [__OpenPilot__](https://github.com/commaai/openpilot)   
모두 기트허브/랩에 공개되어 있으며
착하게 도커로 공개하며 손쉽게 시험해 볼 수 있도록 되어있다.

우선 개발 일정과 자율주행 기능구현을 위해서는 HD MAP에 있어서는 이미 존재하는 규격을 맞추어 진행하는 것이 합리적이라는 본 파트는 위 3개의 플랫폼에서   
수정과 개발이 편하고, 특정 기능의 도입과 호환성이 좋은 HD Map 시스템을 찾아서 우리 시스템에 도입할 생각이다.   

왜 새로이 만들지 않냐면
>  1. 우리 연구팀은 대부분의 시스템을 OSS로 공개한다. 즉, 계속 새로운 규격이 나오는 것보다 있는 규격을 따르는 것이 우리 시스템을 도입하는 개발자 입장에서 편하다.
>  2. Map Annotation Tool 같이 이미 존재하고 있는 Tool에 개발 시간과 자원을 소모하지 않아도된다.
>  3. 이미 2015년부터 꾸준히 연구되고 있는 분야로 지금 규격부터 제시하는 것보다는 응용 분야쪽에 힘을 쓰는 것이 더 효율적일 것이다.

그리고 오픈 플랫폼에 공개된 것 이외에도 다른 연구팀들이 공개하는 규격도 전체적으로 검토하여 general 한 포맷을 찾아서 선정할 생각이다.

## HD Map 포맷과 구조
HD Map은 아래와 같은 구조로 되어 있는데, 미국의 Uber의 라이벌인 Lyft가 공개한 자료이다.

![hdmap-layer](media/hdmap-layer.png)

기본적으로 이미 존재하는 위성지도와 차량에 탑재된 GNSS 를 이용하여 추정하는 방식도 있지만 이 방식은 현재 내비게이션 같은 방식이다.   
당연히 오차도 넓고, 위성지도이다 보니 저화질과 바로바로 업데이트가 안되는 단점도 많다. 하지만 SCAN을 하기위해 인간이 운전을 하지 않아도된다.
이미 이런 단점을 보완하는 기술을 이스라엘에 모빌아이라는 기업이 위성 사진으로 자동으로 HD Map을 만들어주는 솔루션을 공개하였다.   

현재 대부분의 트렌드는 LiDAR의 도움을 받아 PointCloud를 만들고
이를 이용해 SLAM으로 위치를 추정하고 또 GNSS를 나온 결과와 잘 섞어서 정확한 자동차의 위치를 얻는게 주력하고 있다. 동시에
위치 추정 뿐만 아니라 차선, 표지판, 신호등, 교차로 주행 경로등 차에 탑재되는 센서의 Redunduancy를 높일 수 있는 다양한 요소들이 추가되고 있다.   
그래서 아래 앞서 말한 Apollo의 지도는 아래와 같은 요소를 담고 있다.   

![apolloMap](media/apolloMapComponent.png)

이미 이렇게 체계적으로 갖추어진 HD Map을 다시 새로이 설계하는건 시간이 낭비고, 존재하는 HD Map의 성능을 최대한 이끄는 연구와 여기에 새로운 요소를   
추가하는 연구를 해야할 듯 싶다.

추가적으로 이러한 MAP들은 쉽게 Annotation도 가능하다. 아까 말한 차선과 기타 요소들은 사람이 직접 마우스 클릭을 통해 넣기도한다.
이러한 Tool들도 무시할 수 없다.

![LGSVL](media/annotation-import.png)

우리 연구팀이 쓰고 있는 시뮬레이션인 LGSVL은 Unity의 Blender를 이용하여 3D Asset을 관리할 수 있는데 이 떄 Map도 Apollo, Autoware, Lanelet등   
다양한 Map 포맷을 지원한다. 

