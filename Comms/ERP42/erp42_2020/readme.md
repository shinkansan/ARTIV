# ERP통신을 위한 패키지 (erp42_2020)
Version : 1.0.0    
Date : 2020.05.23    
Python : 2    
ROS : 1    
Author : 여호영

이 패키지는 ERP와의 통신을 위한 ROS1 패키지이다.    
하나의 컴퓨터와만의 통신을 위한다면 Ros 패키지에 넣어서 실행할 필요는 없다!    
하지만 우리는 여러 센서들과 상호작용을 이루며 ERP를 작동시키기에 Ros는 필수겠지?

그럼 ERP와 통신을 하려면 어떻게 해야하는지 알아보자.

## 1. ERP42와 컴퓨터 연결

### (1) 선 연결
ERP42에는 RS232 to USB 케이블이 있는데 Not use가 적힌 포트 아래에 RS232포트를 꼽고 USB는 컴퓨터에 꽂으면 된다.

### (2) 연결 권한 얻기
처음에 컴퓨터에 연결하면 ERP42에 해당하는 포트는 '/dev/ttyUSB0'이다.    
단지 연결만 하였을땐 이 포트에서 데이터를 받아올 수 없기에 권한을 얻고 연결을 해보자.    

```sudo chmod a+w /dev/ttyUSB0```    

위 코드를 통해서 권한을 얻고 파이썬으로 작성한 코드를 통해서 ERP42 정보를 얻을 수 있다!    
생각보다 쉽다.

## 2. 패키지 내용 확인

### (1) 메시지 확인
```/msg/ERPmsg.msg```를 보면 ERP42 Message of ARTIV인 메시지 파일을 확인할 수 있다.    
Ros에 publish되는 데이터를 보면 ERPmsg.msg에서 보이는 형태와 같다.    
그렇다면 이런 형태의 메시지는 ERP에서 어떻게 받아올까?

### (2) dbw_erp42_node.py
위 파일은 src폴더에 있는 파이썬 파일이다.    
이 프로그램을 실행을 하게 되면 ERP42에서 넘어오는 데이터를 위의 ERPmsg형식으로 Ros에 publish하게 된다.    
단 이 메시지는 ERP에서 받아오는 raw data로 사람이 이해하기 어려운 정보로 이루어진 메시지이다.    
그렇다면 다른 팀에서 제어를 하기 쉽게 사람이 이해하기 쉬운 데이터 형태로 바꿔줘야겠지?!    

### (3) processing_erp42.py
위 파일 또한 src폴더에 있는 파이썬 파일이다.    
이 파일은 dbw_erp42_node 파일의 topic인 '/ERP42_Info'의 데이터를 사람이 이해하기 쉬운 데이터 형식으로 바꿔준다.    
그러므로 dbw_erp42_node.py파일이 켜져있는 상황에서 실행해야하는 파일이겠지? 데이터는 도대체 어떻게 바꿔주냐고?    
예를 들어보면 속도를 측정하기 위해서는 엔코더 값이 필요하다.    
근데 엔코더 데이터가 하나가 아니라 무려 4개에다가 각 데이터의 범위가 0~255이다.    
이런 사람이 한 눈에 이해하기 어려운 값을 km/h로 바꿔주는 것이다.    
이번엔 정보를 받아오는 것 뿐만 아니라 제어도 해보고 싶다!

### (4) erp42_com_test.py
위 파일 또한 src폴더에 있는 파이썬 파일이다.    
이 파일의 역할은 키보드로 erp42를 제어하는 것이다!    
아직 제어 코드가 없기 때문에 매끄럽게 제어가 되진 않지만 ~~그래도 키보드로 제어할 수 있는게 어디야.~~    
이 파일은 ERP42가 컴퓨터와 연결만 되어있으면 다른 프로그램이 실행되어 있지 않아도 상관없다.    
그럼 대체 어떻게 제어할까?    
게임안에서 캐릭터를 움직이는 것처럼 하면 된다.    

w : 가속(엑셀 증가), s : 감속(엑셀 감소, 브레이크 증가), a : 왼쪽으로 조향, d : 오른쪽으로 조향    
n : 전진 기어(기어 0, 브레이크 100), m : 후진 기어(기어 2, 브레이크 100), q : 프로그램 종료    

참 쉽죠?    
한 가지 문제가 있다면 가속만 딜레이가 매우 심하다는 것이다.    
이는 제작사(Unmanned Solution)에 문의해 답변을 받을 예정이다.    
ERP42 제어 끝~~~

TO DO    

1. ROS2에서도 가능한 코드 작성    
2. ROS2에 맞는 메시지 타입 제작    
3. 데이터 수신 혹은 발신에 딜레이가 생길 것을 대비해 C++ 통신 코드 작성
